<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css">
    <title>Goryaev</title>

    <script src="howler.js"></script>
    <script>

        document.addEventListener("DOMContentLoaded", () => {
        const indicator = document.getElementById('indicator'); 
        const resultline = document.getElementById('result');
    });
        
        

        var sound = new Howl({
        src: ['plop.ogg'],
        preload: true,
        html5: true,
        });
        Howler.autoUnlock = false;
        
        function toggleFullScreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
        } else if (document.exitFullscreen) {
            document.exitFullscreen();
        }
        }

        function cellplus(count) {
            sound.play();
            if (window.navigator.vibrate) window.navigator.vibrate(80);
            cells += 1
            indicator.innerText = cells
            for (let i = 0; i < count-1; i++) {
  
                setTimeout(() => {cells += 1;
                indicator.innerText = cells; sound.play()
                }, 100);
            }
            
            
        }


        var cells = 0
        var suvc = 0
        var dilc = 0
        var stcc = 0

        function initialize () {
            cells = 0
            indicator.innerText = cells
            suvc = document.getElementById("suv").valueAsNumber
            dilc = document.getElementById("dil").valueAsNumber
            stcc = document.getElementById("stc").valueAsNumber
            document.getElementById('result').style.visibility = 'hidden'
            indicator.style.visibility = 'visible' 
        }

        function calculate () {
            power = 5
            result = (cells / stcc) / suvc * (dilc + 1)
            while (Math.floor(result / 10) > 0) {
                result = result / 10
                power += 1
                if (power == 6) {
                    break
                }
            }
            document.getElementById("res").innerText = Math.round(result * 100) / 100
            document.getElementById("power").innerText = power
            document.getElementById('result').style.visibility = 'visible'
            indicator.style.visibility = 'hidden' 
        }


    </script>

</head>

<body>

    <div class="btn-container" style="display: flex;">
        <button onclick="cellplus(1);" id="b1" class="countbtn" style="background: linear-gradient(#72aadf, #6184a5);"></button>
        <span id="indicator" class="unit" style="margin-left: 20%; visibility:hidden;"><b>0</b></span>
    </div>

    <div class="btn-container" >
        <button onclick="cellplus(2);" id="b2" class="countbtn" style="margin-left: 30%; background: linear-gradient(#f3b24f, #f38b4f);"></button>
    </div>

    <div class="btn-container" style="padding: 10px; margin-top: 5vh; height: 5vh; display: flex; align-items: center; justify-content: space-evenly;" >
        <button class="orange" onclick="calculate();">Finish</button>
        <button class="green" onclick="initialize();">Start</button>
        <button onclick="toggleFullScreen();">Fullscreen</button>
    </div>

    <div class="btn-container" style="padding: 10px; height: 5vh; display: flex; align-items: center; justify-content: space-evenly;" >
        <p id="result" class="result" style="visibility:hidden;"><span id="res"></span> • 10<sup><span id="power"></span></sup> cells/ml</p>
    </div>
    <div class="btn-container" style="padding: 10px; height: 5vh; display: flex; align-items: center; text-align: center;" >
        <p>Set the dilution (1 : X), amount of units to count and sigle unit volume (• 10<sup>5</sup>)</p>
    </div>

    <div class="btn-container" style="height: 5vh; display: flex; align-items: center; justify-content: space-evenly;" >
        <input type="number" id="dil" value="1">
        <input type="number" id="stc" value="10">
        <input type="number" id="suv" value="1.6">
    </div>
    
</body>

</html>